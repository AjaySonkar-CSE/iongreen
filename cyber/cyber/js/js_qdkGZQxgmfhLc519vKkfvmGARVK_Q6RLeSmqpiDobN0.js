/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function($,Drupal){var dataLayer=window.dataLayer=window.dataLayer||[];window.triggerWebengageEventFromDataLayer=(dLayerObject)=>{return true;};if(gtm_enabled){window.addEventListener('DOMContentLoaded',function(){if(drupalSettings.sobha_event){var {pageName,pageType,propertyName,propertyType,projectId,projectName,projectCategory,mediaContentType,mediaContentId,mediaContentName}=drupalSettings.sobha_event;if(pageName&&pageType){var dLayerObject={'event':'pageViewTracker','custom_event_name':'pageViewLoad','page_name':pageName.trim().toLowerCase(),'page_type':pageType.trim().toLowerCase(),'event_weightage':1};if(propertyName)dLayerObject.property_name=propertyName.trim().toLowerCase();if(propertyType)dLayerObject.property_type=propertyType.trim().toLowerCase();if(projectId&&projectName){dLayerObject.project_id=projectId.trim().toLowerCase();dLayerObject.project_name=projectName.trim().toLowerCase();}if(projectCategory){if(projectCategory==='empty')projectCategory='';dLayerObject.project_category=projectCategory.trim();}if(mediaContentType)dLayerObject.media_content_type=mediaContentType.trim().toLowerCase();if(mediaContentId&&mediaContentName){dLayerObject.media_content_id=mediaContentId.trim().toLowerCase();dLayerObject.media_content_name=mediaContentName.trim().toLowerCase();}if(drupalSettings.sobha_event?.pageType==='wishlist')dLayerObject={'event':'eventTracker','custom_event_name':'view_wishlist','event_weightage':2};dataLayer.push(dLayerObject);console.log('Page Load event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}if(drupalSettings.sobha_event?.mediaContentId){var timeSpent=0;var timeLimit=20*1000;console.log('Media engagement timer started');var engagementTimer=setInterval(function(){timeSpent+=1000;if(timeSpent>=timeLimit){clearInterval(engagementTimer);let dLayerObject={'event':'eventTracker','custom_event_name':'content_engagement_bucketed','media_content_type':drupalSettings.sobha_event.mediaContentType.trim().toLowerCase(),'media_content_id':drupalSettings.sobha_event.mediaContentId,'media_content_name':drupalSettings.sobha_event.mediaContentName.trim().toLowerCase(),'event_weightage':3};dataLayer.push(dLayerObject);console.log(`Media engagement: 20 seconds`,dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}},1000);}}if(window.location.pathname==='/search'||window.location.pathname==='/ar/search'){let urlParams=new URLSearchParams(window.location.search);let searchTerm=urlParams.get('searchterm')??'';let totalCount=$('#search-result-total-count').text().trim();let dLayerObject={'event':'eventTracker','custom_event_name':'search_success','search_term':searchTerm,'search_result_count':totalCount?totalCount:'0','event_weightage':3};dataLayer.push(dLayerObject);console.log('Search successfull event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});$(document).ready(function(){$.get(window.location.href).fail(function(jqXHR,textStatus,errorThrown){var name='';var message='';if(jqXHR.status==403){name='access denied';message='User does not have enough permission';}else{if(jqXHR.status==404){name='incorrect url';message='Page not found';}}if(name&&message){var dLayerObject={'event':'eventTracker','custom_event_name':'error_occured','error_code':jqXHR.status,'error_name':name,'error_message':message};dataLayer.push(dLayerObject);console.log('Error event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});});}Drupal.behaviors.sobhaEvents={attach:function(context,settings){$(document).ready(function(){var dataLayer=window.dataLayer=window.dataLayer||[];if(gtm_enabled){function getBannerPositionByDocument(bannerElement){var rect=bannerElement[0].getBoundingClientRect();var totalHeight=document.documentElement.scrollHeight;var elementTop=rect.top+window.scrollY;var elementPositionPercentage=(elementTop/totalHeight)*100;var position='center';if(elementPositionPercentage<20)position='top';else if(elementPositionPercentage>=70)position='bottom';else position='center';return position;}function getBannerPosition(banner){var bannerPosition='hero banner';if($(banner).closest('.latest-launch-section').length>0)bannerPosition='property_listing';if($(banner).closest('.sobha-stories-sec').length>0)bannerPosition='media';if($(banner).closest('.career-banner-slider').length>0)bannerPosition='career';if(bannerPosition=='hero banner'){var bannerPosition=getBannerPositionByDocument($(banner));switch(bannerPosition){case "top":bannerPosition='hero banner';break;case "center":bannerPosition='middle banner';break;case "bottom":bannerPosition='footer banner';break;default:break;}}return bannerPosition;}var bannerVisibility={};var observer=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){var banner=$(entry.target);var bannerId=$(banner).data('bannerid');var ctaName=false;if(entry.isIntersecting&&!bannerVisibility[bannerId]){var bannerId=$(banner).data('bannerid');var bannerUploadDate=$(banner).data('upload-date');var bannerPosition=getBannerPosition($(banner));var bannerName=$(banner).attr('alt')??'';var bannerSequenceNumber="1";if($(banner).closest('.swiper-slide').length>0)if($(banner).closest('.swiper-slide').data('swiper-slide-index'))bannerSequenceNumber=String($(banner).closest('.swiper-slide').data('swiper-slide-index')+1);if($(banner).closest('.home-banner').length>0)ctaName=$(banner).closest('.home-banner').find('.explore-more-arrow a.homepage-hero-banner-cta').text().trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'banner_impression','banner_name':bannerName?bannerName.trim().toLowerCase():'','banner_id':bannerId??"",'banner_position':bannerPosition,'banner_upload_date':bannerUploadDate??"",'banner_sequence_number':bannerSequenceNumber,'event_weightage':1};if(ctaName)dLayerObject.cta_name=ctaName;dataLayer.push(dLayerObject);console.log('Banner impression event, data pushed to dataLayer:',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);bannerVisibility[bannerId]=true;}});},{threshold:0.7});$('img.impression-banner').each(function(){observer.observe(this);});jQuery('a img.impression-banner').click(function(){var banner=$(this);var bannerId=$(banner).data('bannerid');var bannerUploadDate=$(banner).data('upload-date');var bannerPosition=getBannerPosition($(banner));var bannerName=$(banner).attr('alt')??'';var bannerSequenceNumber="1";if($(banner).closest('.swiper-slide').length>0)bannerSequenceNumber=String($(banner).closest('.swiper-slide').data('swiper-slide-index')+1);var dLayerObject={'event':'eventTracker','custom_event_name':'banner_interaction','banner_name':bannerName?bannerName.trim().toLowerCase():'','banner_id':bannerId,'banner_position':bannerPosition,'banner_upload_date':bannerUploadDate,'banner_sequence_number':bannerSequenceNumber,'event_weightage':2};dataLayer.push(dLayerObject);console.log('Banner interaction event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once("takeover-banner-click",'#webbanner .buttons-box a')).click(function(){var buttonName=$(this).text().toString().toLowerCase();let banner=$(this).closest('#webbanner').find('img.impression-banner').eq(0);var bannerId=$(banner).data('bannerid');var bannerUploadDate=$(banner).data('upload-date');var bannerName=$(banner).attr('alt').trim().toLowerCase().replace(/ /g,"_")??'';let dLayerObject={'event':'eventTracker','custom_event_name':'takeover_banner_click','banner_name':`takeover_${bannerName}`,'banner_id':bannerId,'banner_position':'takeover banner','banner_upload_date':bannerUploadDate,'banner_sequence_number':1,'cta_name':buttonName,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Takeover banner click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once("menu-level-one",'#slide-nav a.level-1-menu')).click(function(e){var nav_cta_name=$(this).data('translated-text').trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'nav_megamenu','nav_cta_name':nav_cta_name};dataLayer.push(dLayerObject);console.log('Main navigation click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});$(once('sub-menu-click','li.showSingle a, li.level-4-list a, .mobile-megamenu-sub-link a')).click(function(e){var category=$(this).closest('.menu-item-has-children').find('.level-1-menu').data('translated-text').trim().toLowerCase();if($(this).data('translated-text'))var subcategory=$(this).data('translated-text').trim().toLowerCase();else var subcategory=$(this).text().trim().toLowerCase();var navCtaName=`${category}:${subcategory}`;var dLayerObject={'event':'eventTracker','custom_event_name':'sub_nav','nav_cta_name':navCtaName};dataLayer.push(dLayerObject);console.log('Sub navigation click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once("sobha-logo",'header .logo-sec a, header a.logo-sec, footer .footer-logo img')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'logo_click','logo_position':$(this).closest('.footer-logo').length?'footer':'header'};dataLayer.push(dLayerObject);console.log('Site logo click event: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once("footer-menu",'.footer-links a, .footer-bottom-col-right a')).click(function(e){if($(this).closest('.google-review').length>0)return;if($(this).hasClass('app-links')){var dLayerObject={"event":'eventTracker',"custom_event_name":"app_download","app_details":$(this).hasClass("appstore")?"ios":"android","event_weightage":3};dataLayer.push(dLayerObject);console.log('App download click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}else{if($(this).data('translated-text'))var menuTitle=$(this).data('translated-text').trim().toLowerCase();else var menuTitle=$(this).text().trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'nav_footer','nav_cta_name':menuTitle};dataLayer.push(dLayerObject);console.log('Footer navigation click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});if(jQuery('.latest-launch-section').length>0)jQuery(once("homepage-property-banner",'.latest-launch-section .latest-launch-slider .new-launch-banner img')).click(function(e){var property=$(this).closest('.swiper-slide').data('title').trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'property_banner_interaction','banner_name':property,'property_name':property,'event_weightage':2};dataLayer.push(dLayerObject);console.log('Homepage properties banner click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.sobha-stories-sec').length>0)jQuery(once("homepage-press-release-banner",'.sobha-stories-sec a.s-stories-slide-box')).click(function(e){var title=$(this).closest('.swiper-slide').find('.story-title h4').data('translated-text').trim().toLowerCase();var contentId=$(this).closest('.swiper-slide').data('contentid');var dLayerObject={'event':'eventTracker','custom_event_name':'press_release_banner_interaction','banner_name':title,'media_content_type':'press release','media_content_id':contentId,'media_content_name':title,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Homepage press release banner click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.art-of-detail-sec').length>0)jQuery(once("homepage-discover-link",'.art-of-detail-sec a')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'home_discover_more','event_weightage':1};dataLayer.push(dLayerObject);console.log('Homepage discover more click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.latest-launch-section').length>0)jQuery(once("homepage-explore-link",'.latest-launch-section .button-main a.button-1')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'explore_all_property'};dataLayer.push(dLayerObject);console.log('Homepage explore property click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.sobha-stories-sec').length>0)jQuery(once("homepage-viewall-press-release-link",'.sobha-stories-sec .button-main a.view-all')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'view_all_press_release'};dataLayer.push(dLayerObject);console.log('Homepage viewall press release click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.our-reports-sec').length>0||jQuery('.report-box-content').length>0)jQuery(once("about-pdf",`.our-reports-sec .our-reports-banner .button-main a.button-1, 
                                .report-box-content a.download-button`)).click(function(e){var title='';if($(this).closest('.report-box-content').length>0)title=$(this).closest('.report-box-content').find('h4').data('translated-text').trim().toLowerCase();else title=$(this).closest('.our-reports-banner').find('h5').eq(0).text().trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'pdf_download','pdf_name':title,'event_weightage':3};dataLayer.push(dLayerObject);console.log('PDF download click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.community-lists').length>0)jQuery(once("community-discover-link",'.community-lists .community-slider-row a.button-1')).click(function(e){var title=$(this).data('title')?.trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'community_discover_more','property_name':title??"",'event_weightage':1};dataLayer.push(dLayerObject);console.log('Homepage discover more click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.amenities-list-of-community').length>0)jQuery(once("community-property",'.amenities-list-of-community .each-amenities-content .sub-property-links a')).click(function(e){var title=$(this).data('translated-text').trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'property_click','property_name':title,'event_weightage':2};dataLayer.push(dLayerObject);console.log('Community detail page property click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if($('.amenities-list-of-community').length>0||$('#footer-common-form').length>0||$('.listing-wrapper .category-lists-slider .category-button').length>0)jQuery(once("community-tab",`.amenities-list-of-community #navigation a,
                                #footer-common-form button.tablinks,
                                .listing-wrapper .category-lists-slider .category-button`)).click(function(e){var tabName=$(this).text().trim().toLowerCase();if($(this).data('translated-text'))var tabName=$(this).data('translated-text').trim().toLowerCase();if($(this).find('.link-title').length>0)var tabName=$(this).find('.link-title').data('translated-text').trim().toLowerCase();else{if($(this).find('.nodeTitle').length>0)var tabName=$(this).find('.nodeTitle').data("translated-text").trim().toLowerCase();}var dLayerObject={'event':'eventTracker','custom_event_name':'tab_interaction','tab_name':tabName,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Community detail page tabs click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.listing-section-wrapper .listing-div').length>0||$('.listing-wrapper .river-side-row').length>0){jQuery(once('properties-click-listing-page','.listing-section-wrapper .listing-div h5 a, .listing-section-wrapper .listing-div .button-main a, .listing-section-wrapper .listing-div a.map-address-anchor')).click(function(e){var eventName='property_click';var eventWeightage=2;if($(this).hasClass('map-address-anchor')){eventName='view_location';eventWeightage=1;}var parentDiv=$(this).closest('.listing-div');var propertyName=$(parentDiv).data('group-property');var unitType=$(parentDiv).find('p.no-of-bedrooms').data('unit-type')?.trim().toLowerCase();var propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();if($(parentDiv).find('h5 a').length>0)var projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else var projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();var priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;var dLayerObject={'event':'eventTracker','custom_event_name':eventName,'project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType,'property_price_range':priceRange,'event_weightage':eventWeightage};dataLayer.push(dLayerObject);console.log('Property listing page property click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once('properties-click-listing-page','.listing-wrapper .river-side-row a.learn-more')).click(function(e){var parentDiv=$(this).closest('.listing-div');var propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();var unitType=false;if($(this).closest('.river-side-list-right').find('p.no-of-bedrooms').length>0)unitType=$(this).closest('.river-side-list-right').find('p.no-of-bedrooms').data('translated-text').trim().toLowerCase();var propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();var projectName=$(this).closest('.river-side-list-right').find('h5').data('translated-text').trim().toLowerCase();var priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;var dLayerObject={'event':'eventTracker','custom_event_name':'property_click','project_name':projectName,'property_name':propertyName,'property_type':propType,'property_price_range':priceRange,'event_weightage':2};if(unitType)dLayerObject.unit_type=unitType;dataLayer.push(dLayerObject);console.log('Property listing page property click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once('properties-social-share','.listing-section-wrapper .listing-div .white-social-div a')).click(function(e){var ctaName=$(this).data('translated-text').trim().toLowerCase();var eventName='property_social_share';var parentDiv=$(this).closest('.listing-div');var propertyName=$(parentDiv).data('group-property');var unitType=$(parentDiv).find('p.no-of-bedrooms').data('unit-type')?.trim().toLowerCase();var propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();if($(parentDiv).find('h5 a').length>0)var projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else var projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();var priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;var dLayerObject={'event':'eventTracker','custom_event_name':eventName,'cta_name':ctaName,'project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType,'property_price_range':priceRange,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Property listing page social share event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});}if(jQuery('.for-propert-detail-page-second-wrapper').length>0){jQuery(once('properties-detail-page-brochure','.for-propert-detail-page-second-wrapper .project-detail-download-btn a')).click(function(e){var propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();var unitType=false;if($('#project-detail-units').length>0)unitType=$('#project-detail-units').data('unit-type').trim().toLowerCase();var propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();var projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'download_brochure','project_name':projectName,'property_name':propertyName,'property_type':propType,'event_weightage':3};if(unitType)dLayerObject.unit_type=unitType;dataLayer.push(dLayerObject);console.log('Property detail page brochure click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once('properties-detail-page-brochure','.riverside-lisiting .button-main a.download-brochure')).click(function(e){var propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();var unitType=false;if($(this).closest('.river-side-list-right').find('p.no-of-bedrooms').length>0)unitType=$(this).closest('.river-side-list-right').find('p.no-of-bedrooms').data('translated-text').trim().toLowerCase();var propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();var projectName=$(this).closest('.river-side-list-right').find('h5').data('translated-text').trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'download_brochure','project_name':projectName,'property_name':propertyName,'property_type':propType,'event_weightage':3};if(unitType)dLayerObject.unit_type=unitType;dataLayer.push(dLayerObject);console.log('Property detail page brochure click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});}if(jQuery('.virtual-floor-plan-wrapper').length>0)jQuery(once('properties-floorplan-download','.virtual-floor-plan-wrapper .floor-plan .swiper-slide a')).click(function(e){var propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();var unitType=$(this).closest('.virtual-floor-plan-wrapper').find('.category-button.active').data("translated-text").trim().toLowerCase().replace('br','bedroom');var propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();var projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'download_floor_plan','project_name':projectName,'property_name':propertyName,'property_type':propType,'unit_type':unitType,'event_weightage':3};dataLayer.push(dLayerObject);console.log('Property detail page floor plan download event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.virtual-floor-plan-wrapper').length>0)jQuery(once('properties-floorplan-interaction','.virtual-floor-plan-wrapper #virtual-tour-tab-slider .category-button')).click(function(e){var propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();var unitType=$(this).data("translated-text").trim().toLowerCase().replace('br','bedroom');var propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();var projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'floor_plan_interaction','project_name':projectName,'property_name':propertyName,'property_type':propType,'unit_type':unitType,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Property detail page floor plan interaction event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.career-lists-sec').length>0)jQuery(once('career-job-apply','.career-lists-sec .accordion-item a.read-more')).click(function(e){var title=$(this).closest('.accordion-item').find('span.acc-title').data("translated-text").trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'apply_now','post_name':title,'event_weightage':1};dataLayer.push(dLayerObject);console.log('Career page apply now click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if(jQuery('.faq-section-common button.accordion-button').length>0)jQuery(once('faq-click','.faq-section-common button.accordion-button')).click(function(e){if($(this).find('.acc-qs-title .acc-title').data("translated-text"))var title=$(this).find('.acc-qs-title .acc-title').data("translated-text").trim().toLowerCase();else var title=$(this).find('.acc-qs-title .acc-title').text().trim().toLowerCase();if($(this).hasClass('collapsed'))return;var dLayerObject={'event':'eventTracker','custom_event_name':'faq_click','faq':title,'event_weightage':1};dataLayer.push(dLayerObject);console.log('FAQ click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});drupalSettings.initialise=true;var successAjaxEvent=Drupal.Ajax.prototype.eventResponse;Drupal.Ajax.prototype.eventResponse=function(element,event){if(this.$form&&(this.$form.attr('id')==='views-exposed-form-properties-mapping-block-1'||this.$form.attr('id')==='views-exposed-form-properties-mapping-block-6')){var form=`#${this.$form.attr('id')}`;var propertyType='all';var propertyTypes=$(form).find('select[name="field_property_type_target_id[]"]').val();var propertyTextValues=[];if(propertyTypes.length>0){propertyType='';$(form).find('select[name="field_property_type_target_id[]"] option:selected').each(function(){var text=$(this).text();var englishText=$(this).data('translated-text');if(englishText)propertyTextValues.push(englishText);else propertyTextValues.push(text);});propertyType=propertyTextValues.join(', ').toLowerCase();}var bedrooms=$(form).find('select[name="field_number_of_bedrooms_target_id"] option:selected');if(bedrooms.data('translated-text'))bedrooms=String(bedrooms.data('translated-text')).toLowerCase();else bedrooms=String(bedrooms.text()).toLowerCase();let projectCategory='';var price=$(form).find('select[name="field_price_range_target_id"] option:selected');if(price.data('translated-text'))price=String(price.data('translated-text')).toLowerCase();else price=String(price.text()).toLowerCase();switch(price){case "aed < 5m":projectCategory='B';break;case "aed 5m+ - 10m":projectCategory='B+';break;case "aed 10m+ - 15m":projectCategory='A';break;case "aed 15m+ - 20m":projectCategory='A';break;case "aed 10m+ - 20m":projectCategory='A';break;case "aed 20m+":projectCategory='A';break;default:projectCategory='';break;}var city=$(form).find('select[name="field_city_target_id"] option:selected');if(city.data('translated-text'))city=String(city.data('translated-text')).toLowerCase();else city=String(city.text()).toLowerCase();var location=$(form).find('select[name="field_property_location_target_id"] option:selected');if(location.data('translated-text'))location=String(location.data('translated-text')).toLowerCase();else location=String(location.text()).toLowerCase();if($('#properties-mapping-total-results').length>0)setTimeout(()=>{var totalResults=$('#properties-mapping-total-results').text().trim();var dLayerObject={'event':'eventTracker','custom_event_name':'filter_applied','filter_result_count':totalResults,'property_type':propertyType,'bedrooms':bedrooms,'price':price,'city':city,'location':location,'project_category':projectCategory,'event_weightage':2};if(drupalSettings.initialise&&event.isTrigger==undefined){drupalSettings.initialise=false;dataLayer.push(dLayerObject);console.log('Search with filters event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}},2000);}setTimeout(()=>drupalSettings.initialise=true,2500);successAjaxEvent.apply(this,arguments);};if(jQuery('#views-exposed-form-properties-mapping-block-1').length>0||jQuery('#views-exposed-form-properties-mapping-block-6').length>0){jQuery(once('reset-click',`#views-exposed-form-properties-mapping-block-1 .exp-reset, 
                                #views-exposed-form-properties-mapping-block-6 .exp-reset`)).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'filter_reset'};dataLayer.push(dLayerObject);console.log('Filter reset event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});jQuery(once('sort-by-click',`.filter-main.sort-filter-for-desktop select, form.views-exposed-form .filter-main.sort-filter-for-mobile select`)).change(function(e){let sortByName=$(this).find('option:selected').data('label');if(sortByName!=''){var dLayerObject={'event':'eventTracker','custom_event_name':'sort_by_price','sort_by':sortByName,'event_weightage':2};dataLayer.push(dLayerObject);console.log('Filter sort by event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});}jQuery(once("unique-lead-id",'form.webform-submission-form input[type="hidden"][name="unique_lead_id"]')).each(function(){if(typeof crypto.randomUUID!='undefined'){const uniqueId=crypto.randomUUID();jQuery(this).val(uniqueId);}else jQuery(this).val('');});if($('.webform-submission-form').length>0)$(once('enquiry-form-started','.webform-submission-form input, .webform-submission-form select')).on('focus',function(){if($(this).is('input[type="submit"]')||$(this).is('input[type="hidden"]')||!$(this).is(':visible')||$(this).closest('.webform-submission-form').hasClass('webform-submission-careers-form-form'))return;if($(this).is('input[name="preferred_mode_of_contact"]')&&$(this).closest('.webform-property-detail').length>0)return;var fieldName=$(this).attr('name');if(!fieldName)fieldName=$(this).siblings('input').attr('name');var formWrapperId=jQuery(this).closest('.webform-ajax-form-wrapper').attr('id');if(!formWrapperId)return;var webformId=formWrapperId.replace(/^webform-submission-/,'').replace(/-form-ajax.*/,'').replace(/-/g,'_');$('body').attr(`enquiry_form_last_field_${webformId}`,fieldName);if(!$('body').attr(`enquiry_form_tracked_${webformId}`)){$('body').attr(`enquiry_form_tracked_${webformId}`,true);var propertyType='';if($(this).closest('form').find('select[name="type"]').val()!=''){propertyType=$(this).closest('form').find('select[name="type"]').val();let propertyTypes={180:"apartments",181:"villas",182:"villaments",183:"penthouses"};propertyType=propertyTypes[propertyType]??'';}var propertyName='';if($(this).closest('form').find('select[name="property_type"]').val()!=='')if($('.node-title').data("translated-text"))propertyName=$('.node-title').data("translated-text").toLowerCase();else propertyName=$(this).closest('form').find('select[name="property_type"] option:selected').text().toLowerCase();var unitType='';if($(this).closest('form').find('select[name="unit_type"]').val()!==''){unitType=$('.footer-enquiry-form').find('select[name="unit_type"]').val();let unitTypes={2:"1 bedroom",3:"1.5 bedroom",4:"2 bedroom",5:"2.5 bedroom",6:"3 bedroom",7:"3.5 bedroom",8:"4 bedroom",9:"4.5 bedroom",10:"5 bedroom",11:"5.5 bedroom",12:"6 bedroom",384:"7 bedroom",446:"3 duplexes"};unitType=unitTypes[unitType]??'';}var contact_preference_mode=false;if($(this).closest('form').find('input[name="preferred_mode_of_contact"]').val()!==''){let contact_preference_mode_val=$(this).closest('form').find(`input[name="preferred_mode_of_contact"]:checked`).val();if(contact_preference_mode_val=='phone call')contact_preference_mode='request a call back';else if(contact_preference_mode_val=='video call')contact_preference_mode='schedule a video call';else contact_preference_mode=$(this).closest('form').find(`input[name="preferred_mode_of_contact"]:checked`).next('label').text().toLowerCase();}var formType='enquiry form';if($(this).closest('form').hasClass('webform-submission-google-discovery-campaign-channe-form')||$(this).closest('form').hasClass('webform-submission-channel-partner-registration-form'))formType='channel partner form';var dLayerObject={'event':'eventTracker','custom_event_name':'form_start','form_type':formType,'event_weightage':3};if(propertyType&&propertyName){dLayerObject.property_name=propertyName;dLayerObject.property_type=propertyType;}if(unitType)dLayerObject.unit_type=unitType;if(contact_preference_mode)dLayerObject.contact_preference_mode=contact_preference_mode;dataLayer.push(dLayerObject);console.log('Enquiry form start event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});if($('.webform-submission-careers-form-form').length>0)$(once('career-form-started','.webform-submission-careers-form-form input, .webform-submission-careers-form-form select')).on('focus',function(){if($(this).is('input[type="submit"]')||$(this).is('input[type="hidden"]')||!$(this).is(':visible'))return;var fieldName=$(this).attr('name');if(!fieldName)fieldName=$(this).siblings('input').attr('name');$('body').attr('career-form-last-field',fieldName);if(!$('body').attr('career-form-tracked')){$('body').attr('career-form-tracked',true);var dLayerObject={'event':'eventTracker','custom_event_name':'form_start','form_type':'job application form','event_weightage':3};dataLayer.push(dLayerObject);console.log('Career form start event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}});if(typeof Drupal.Ajax!=='undefined')if(typeof Drupal.Ajax.prototype.beforeSubmitOriginal==='undefined'){Drupal.Ajax.prototype.beforeSubmitOriginal=Drupal.Ajax.prototype.beforeSubmit;Drupal.Ajax.prototype.beforeSubmit=function(form_values,element_settings,options){if(typeof this.$form!=='undefined'&&($(this.$form).attr('id')=='views-exposed-form-properties-mapping-block-1'||$(this.$form).attr('id')=='views-exposed-form-properties-mapping-block-6'))if($('.desktop-filter-section').hasClass('filter-open')){$('.desktop-filter-section').removeClass('filter-open');$(".desktop-filter-section").removeClass("mobile");$('body').css('overflow','auto');}if($(element_settings).hasClass('webform-submission-form')&&typeof this.$form!=='undefined')setTimeout(()=>{if(!$(this.$form).hasClass('ajax-submit-prevented')&&$(this.$form).valid()){const self=this;let submission_values=form_values.reduce((acc,field)=>{acc[field.name]=field.value;return acc;},{});if(submission_values['unique_lead_id']&&$(self.$form).length>0){var form_type='enquiry form';if($(element_settings).hasClass('webform-submission-careers-form-form'))form_type='job application form';if($(self.$form).hasClass('webform-submission-google-discovery-campaign-channe-form')||$(self.$form).hasClass('webform-submission-channel-partner-registration-form'))form_type='channel partner form';var dLayerObject={'event':'eventTracker','custom_event_name':'form_submit_progress','form_type':form_type,'lead_reference_id':String(submission_values['unique_lead_id']),'event_weightage':10};if(submission_values['preferred_mode_of_contact']){var contactPrefModeVal=submission_values['preferred_mode_of_contact'];dLayerObject.contact_preference_mode=$(self.$form).find(`input[name="preferred_mode_of_contact"][value="${contactPrefModeVal}"]`).next('label').text().toLowerCase();}if(submission_values['property_name'])dLayerObject.project_name=submission_values['property_name'].toLowerCase();var entityIds=[];if(submission_values['property_type']){var projectId=submission_values['property_type'];entityIds.push({id:projectId,type:'node',name:'project_name'});var projectName=$(self.$form).find('select[name="property_type"] option[value="'+projectId+'"]');if(projectName.data('property-id'))if(projectName.data('property-id')!='')entityIds.push({id:projectName.data('property-id'),type:'node',name:'property_name'});if(projectName.length>0)if(projectName?.data('property')!='')dLayerObject.property_name=projectName?.data('property')?.toLowerCase();}if(submission_values['type']){var typeId=submission_values['type'];entityIds.push({id:typeId,type:'term',name:'property_type'});var typeName=$(self.$form).find('select[name="type"] option[value="'+typeId+'"]');if(typeName.length>0)dLayerObject.property_type=typeName?.text().toLowerCase();}if(submission_values['unit_type']){var unitId=submission_values['unit_type'];entityIds.push({id:unitId,type:'term',name:'unit_type'});var unitName=$(self.$form).find('select[name="unit_type"] option[value="'+unitId+'"]');if(unitName.length>0)dLayerObject.unit_type=unitName?.text().toLowerCase();}if(submission_values['budget']){var budgetId=submission_values['budget'];entityIds.push({id:budgetId,type:'term',name:'budget'});var budgetName=$(self.$form).find('select[name="budget"] option[value="'+budgetId+'"]');if(budgetName.length>0)dLayerObject.budget=budgetName?.text().toLowerCase();}if(submission_values['bed_enquired_for']){var budgetId=submission_values['bed_enquired_for'];entityIds.push({id:budgetId,type:'term',name:'budget'});var budgetName=$(self.$form).find('select[name="bed_enquired_for"] option[value="'+budgetId+'"]');if(budgetName.length>0)dLayerObject.budget=budgetName?.text().toLowerCase();}if(drupalSettings.path.currentLanguage!='en'&&entityIds.length>0)$.ajax({url:'/api/reverse_translation',method:'POST',contentType:'application/json',data:JSON.stringify(entityIds),success:function(response){response.forEach((element)=>{let value=element.label.toLowerCase();if(element.name=="unit_type")value=`${value} bedroom`;dLayerObject[element.name]=element.label.toLowerCase();});dataLayer.push(dLayerObject);localStorage.setItem('latest_webform_submission',JSON.stringify(dLayerObject));window.triggerWebengageEventFromDataLayer(dLayerObject);console.log('form submit progress event triggered: ',dLayerObject);}});else{dataLayer.push(dLayerObject);localStorage.setItem('latest_webform_submission',JSON.stringify(dLayerObject));window.triggerWebengageEventFromDataLayer(dLayerObject);console.log('form submit progress event triggered: ',dLayerObject);}}}},1);return Drupal.Ajax.prototype.beforeSubmitOriginal.apply(this,arguments);};}var appointmentPage=once('appointment-redirection','.schedule-cancel-reschedule');$(appointmentPage).each(function(){const appointmentPage=localStorage.getItem("appointment_page_redirect");if(appointmentPage==="true"){let latestWebformSubmission=JSON.parse(localStorage.getItem("latest_webform_submission"));if(latestWebformSubmission){latestWebformSubmission.custom_event_name='redirected_to_appointment_page';dataLayer.push(latestWebformSubmission);console.log('Appointment Page redirect event triggered: ',latestWebformSubmission);localStorage.setItem('appointment_redirect_event',JSON.stringify(latestWebformSubmission));}localStorage.removeItem("appointment_page_redirect");localStorage.removeItem("latest_webform_submission");}});var body=once('form-track-abondonment','body');$(body).each(function(){let abandonTimeout;var bodyElement=this;$('.modal').on('hidden.bs.modal',function(e){var modal=$(this);var careerFormAbondoned=$('body').attr('career-form-tracked');if(careerFormAbondoned){var lastField=$('body').attr('career-form-last-field');addDLayerFormAbandonmentCareer(lastField);}var enquiryFormsTracked=getEnuiryFormsTracked(bodyElement);if(enquiryFormsTracked.length>0)enquiryFormsTracked.forEach(function(name){var webformName=name.replace('enquiry_form_tracked_','');var webformEl=modal.find(`form.webform-submission-${webformName.replace(/_/g,'-')}-add-form`);if(webformEl.length>0){var lastFieldAttr=name.replace('enquiry_form_tracked','enquiry_form_last_field');var lastField=$('body').attr(lastFieldAttr);addDLayerFormAbondonmentEnquiry(lastField,webformEl);$('body').removeAttr(name);$('body').removeAttr(`enquiry_form_last_field_${webformName}`);}});});$('#slidingform').on('hidden.sobha.slidingModal',function(){var modal=$(this);var careerFormAbondoned=$('body').attr('career-form-tracked');if(careerFormAbondoned){var lastField=$('body').attr('career-form-last-field');addDLayerFormAbandonmentCareer(lastField);}var enquiryFormsTracked=getEnuiryFormsTracked(bodyElement);if(enquiryFormsTracked.length>0)enquiryFormsTracked.forEach(function(name){var webformName=name.replace('enquiry_form_tracked_','');var webformEl=modal.find(`form.webform-submission-${webformName.replace(/_/g,'-')}-add-form`);if(webformEl.length>0){var lastFieldAttr=name.replace('enquiry_form_tracked','enquiry_form_last_field');var lastField=$('body').attr(lastFieldAttr);addDLayerFormAbondonmentEnquiry(lastField,webformEl);$('body').removeAttr(name);$('body').removeAttr(`enquiry_form_last_field_${webformName}`);}});});$(window).on("beforeunload",function(){trackFormAbandonment();});$(window).on("pagehide",function(){trackFormAbandonment();});$(document).on("visibilitychange",function(){if(document.visibilityState==="hidden")abandonTimeout=setTimeout(trackFormAbandonment,10000);else clearTimeout(abandonTimeout);});function getEnuiryFormsTracked(bodyElement){var enquiryFormsTracked=[];var bodyAttributes=bodyElement.attributes;$.each(bodyAttributes,function(){if(this.name.startsWith('enquiry_form_tracked_'))enquiryFormsTracked.push(this.name);});return enquiryFormsTracked;}function addDLayerFormAbandonmentCareer(lastField){var dLayerObject={'event':'eventTracker','custom_event_name':'form_abandonment','form_abandonment_field':lastField,'form_type':'job application form'};dataLayer.push(dLayerObject);$('body').removeAttr('career-form-tracked');$('body').removeAttr('career-form-last-field');console.log('Form abondoned career form event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}function addDLayerFormAbondonmentEnquiry(lastField,webformEl){var formType='enquiry form';if($(webformEl).hasClass('webform-submission-google-discovery-campaign-channe-form')||$(webformEl).hasClass('webform-submission-channel-partner-registration-form'))formType='channel partner form';var dLayerObject={'event':'eventTracker','custom_event_name':'form_abandonment','form_abandonment_field':lastField,'form_type':formType};var propertyType='';if($(webformEl).find('select[name="type"]').val()!=''){propertyType=$(webformEl).find('select[name="type"]').val();let propertyTypes={180:"apartments",181:"villas",182:"villaments",183:"penthouses"};propertyType=propertyTypes[propertyType]??'';}var projectName='';if($(webformEl).find('select[name="property_type"]').val()!='')if($(webformEl).find('select[name="property_type"] option:selected').data('translated-text'))projectName=$(webformEl).find('select[name="property_type"] option:selected').data('translated-text').toLowerCase();else projectName=$(webformEl).find('select[name="property_type"] option:selected').text().toLowerCase();var propertyName='';if($(webformEl).find('select[name="property_type"]').val()!='')propertyName=$(webformEl).find('select[name="property_type"] option:selected').data('property')?.toLowerCase();var unitType='';if($(webformEl).find('select[name="unit_type"]').val()!=''){unitType=$(webformEl).find('select[name="unit_type"]').val();let unitTypes={2:"1 bedroom",3:"1.5 bedroom",4:"2 bedroom",5:"2.5 bedroom",6:"3 bedroom",7:"3.5 bedroom",8:"4 bedroom",9:"4.5 bedroom",10:"5 bedroom",11:"5.5 bedroom",12:"6 bedroom",384:"7 bedroom",446:"3 Duplexes"};unitType=unitTypes[unitType]??'';}var contact_preference_mode=false;if($(webformEl).find('input[name="preferred_mode_of_contact"]').val()!='')contact_preference_mode=$(webformEl).find(`input[name="preferred_mode_of_contact"]:checked`).next('label').text().toLowerCase();if(propertyType)dLayerObject.property_type=propertyType;if(projectName)dLayerObject.project_name=projectName;if(propertyName&&propertyName!='')dLayerObject.property_name=propertyName;if(unitType)dLayerObject.unit_type=unitType;if(contact_preference_mode)dLayerObject.contact_preference_mode=contact_preference_mode;dataLayer.push(dLayerObject);console.log('Form abondoned enquiry form event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}function trackFormAbandonment(){var careerFormAbondoned=$('body').attr('career-form-tracked');if(careerFormAbondoned){var lastField=$('body').attr('career-form-last-field');addDLayerFormAbandonmentCareer(lastField);}var enquiryFormsTracked=getEnuiryFormsTracked(bodyElement);if(enquiryFormsTracked.length>0)enquiryFormsTracked.forEach(function(name){var lastFieldAttr=name.replace('enquiry_form_tracked','enquiry_form_last_field');var lastField=$('body').attr(lastFieldAttr);var webformName=name.replace('enquiry_form_tracked_','');var webformEl=$(`form.webform-submission-${webformName.replace(/_/g,'-')}-add-form`);addDLayerFormAbondonmentEnquiry(lastField,webformEl);$('body').removeAttr(name);$('body').removeAttr(`enquiry_form_last_field_${webformName}`);});}});$.fn.sobhaFormSuccessEvent=function(data,webformId,webformWrapper){if(gtm_enabled){if(!data['unique_lead_id'])return;var webformEl=webformId;webformId=webformId.replace(/^webform_submission_/,'').replace(/_add_form.*/,'');let gclid=false;if(webformWrapper&&jQuery(`#${webformWrapper}`).closest('#slidingform').length>0)gclid=true;if(data['webform_name']==='job_application'){$('body').removeAttr('career-form-tracked');$('body').removeAttr('career-form-last-field');var dLayerObject={'event':'eventTracker','custom_event_name':'form_submit_success','form_type':'job application form','email':data.email??'','phone_number':data.phone??'','lead_reference_id':data['unique_lead_id']??'','event_weightage':10};dataLayer.push(dLayerObject);console.log('Career form success triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);}else{if(data['webform_name']==='enquiry_property_form'){var formType='enquiry form';$form=$(`form input[value="${webformEl}"]`).closest('form');if($form.length>0&&($($form).hasClass('webform-submission-google-discovery-campaign-channe-form')||$($form).hasClass('webform-submission-channel-partner-registration-form')))formType='channel partner form';$('body').removeAttr(`enquiry_form_tracked_${webformId}`);$('body').removeAttr(`enquiry_form_last_field_${webformId}`);var dLayerObject={'event':'eventTracker','custom_event_name':'form_submit_success','form_type':formType,'email':data.email??'','phone_number':data.phone??'','lead_reference_id':data['unique_lead_id']??'','event_weightage':10};if(data['preferred_mode_of_contact']){var contactPrefModeVal=data['preferred_mode_of_contact'];dLayerObject.contact_preference_mode=$form.find(`input[name="preferred_mode_of_contact"][value="${contactPrefModeVal}"]`).next('label').text().toLowerCase();}if(data['property_name'])dLayerObject.project_name=data['property_name'].toLowerCase();if(data['type'])dLayerObject.property_type=data['type'].toLowerCase();if(data['property_group'])dLayerObject.property_name=data['property_group'].toLowerCase();if(data['unit_type'])dLayerObject.unit_type=data['unit_type'].toLowerCase();if(data['budget_val'])dLayerObject.budget=data['budget_val'].toLowerCase();else{if(data['bed_enquired_for'])dLayerObject.budget=data['bed_enquired_for'].toLowerCase();}if(gclid){const urlParams=new URLSearchParams(window.location.search);dLayerObject.gclid=urlParams.get('gclid')??'';}dataLayer.push(dLayerObject);console.log('Enquiry form success triggered: ',dLayerObject);localStorage.removeItem("latest_webform_submission");window.triggerWebengageEventFromDataLayer(dLayerObject);}}}};if(jQuery('body #notification').length>0)jQuery(once("newsletter-click",'body #notification')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'newsletter_icon_clicked','event_weightage':1};dataLayer.push(dLayerObject);console.log('Newsletter icon click event triggered: ',dLayerObject);});if($('.social-icons a').length>0)jQuery(once('social-media-click','.social-icons a')).click(function(e){var name=$(this).find('img').attr('alt').trim().toLowerCase();var dLayerObject={'event':'eventTracker','custom_event_name':'social_share','social_network':name};dataLayer.push(dLayerObject);console.log('Social icons click event triggered: ',dLayerObject);});if(drupalSettings.sobha_event?.pageType==='media')jQuery(once('media-read-more','a.read-more, span.read-link')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'read_more','event_weightage':1};if($(this).hasClass('read-more')){var parent=$(this).closest('.blog-featured-row');if(parent.length>0){dLayerObject.media_content_name=$(parent).find('h4').data("translated-text").trim().toLowerCase();dLayerObject.media_content_id=$(parent).data('nid');dLayerObject.media_content_type=$(parent).data('type').trim().toLowerCase();dLayerObject.section_name=$(this).closest('.blog-featured-sec').find('h1').data("translated-text").trim().toLowerCase();}}if($(this).hasClass('read-link')){var parent=$(this).closest('.blog-list-box');if(parent.length>0){dLayerObject.media_content_name=$(parent).find('h5').data("translated-text").trim().toLowerCase();dLayerObject.media_content_id=$(parent).data('nid');dLayerObject.media_content_type=$(parent).data('type').trim().toLowerCase();if(dLayerObject.media_content_type==='press_releases')dLayerObject.section_name='Sobha Realty: Press Releases';else dLayerObject.section_name='Sobha Realty: Real Estate News & Blogs';}}dataLayer.push(dLayerObject);console.log('Read more click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if($('.our-team').length>0)$(once("read-more-team",'.our-team a.read-more')).on('click',function(e){var parent=$(this).closest('.team-box-main');var name=parent.find('h4').data("translated-text").trim().toLowerCase();var id=parent.data('pid');var dLayerObject={'event':'eventTracker','custom_event_name':'read_more','event_weightage':1,'media_content_name':name,'media_content_id':id,'media_content_type':'team','section_name':'our management team'};dataLayer.push(dLayerObject);console.log('Read more click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if($('.our-initiatives-wrapper').length>0)$(once("initiatives-read-more",'.our-initiatives-wrapper a.phil-read-more')).on('click',function(e){var parent=$(this).closest('.our-initiatives-section');var name=parent.find('h3.phil-headng').data("translated-text").trim().toLowerCase();var id=parent.data('pid');var dLayerObject={'event':'eventTracker','custom_event_name':'read_more','event_weightage':1,'media_content_name':name,'media_content_id':id,'media_content_type':'our initiative','section_name':'our initiatives'};dataLayer.push(dLayerObject);console.log('Read more click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});if($('#enq-form .eng-buton-list').length>0)$(once('footer-enquiry-btn','#enq-form .eng-buton-list a:not(.vr)')).click(function(e){var dLayerObject={'event':'eventTracker','custom_event_name':'enquiry_clicked','cta_name':$(this).find('span').data("translated-text").trim().toLowerCase(),'event_weightage':3};dataLayer.push(dLayerObject);console.log('Footer enquiry button click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});$(once("generic-cta",`
                            #seek-job-div a,
                            #c-link-div a,
                            .journey-slider-sec a.button-1.view-all, 
                            .our-esg-policy-sec a, 
                            [title="Load more items"],
                            a[data-translated-text="Load more"],
                            #verticalTab ul.resp-tabs-list li,
                            .reports-sec button.tablinks,
                            .career-banner-each-slide a.button-1,
                            .office-adrres-list-col a,
                            .contact-section-1 a,
                            .page-node-type-partnerships a.bog-box,
                            .page-node-type-partnerships a.topic-tag,
                            .strategic-list .strategic-list-row a.button-1`)).on('click',function(e){var channelPartner=false;var pageName=getPageTitle();if($(this).data("translated-text"))var ctaName=$(this).data("translated-text").trim().toLowerCase();else var ctaName=$(this).text().trim().toLowerCase();let ctaType='';if($(this).closest('#c-link-div').length>0||$(this).closest('#seek-job-div').length>0)channelPartner=true;if($(this).prop('tagName').toLowerCase()==='a'){ctaType='link';var href=$(this).prop('href');if(href)if(href.indexOf('tel:')===0){ctaType='telephone link';channelPartner&&(ctaName='contact');}else if(href.indexOf('mailto:')===0){ctaType='mail link';channelPartner&&(ctaName='contact');}else{if(href.indexOf('goo.gl/maps')!==-1||href.indexOf('https://www.google.com/maps')===0)ctaType='maps direction link';}}else ctaType='button';var ctaPosition=getCtaPosition($(this));var dLayerObject={'event':'eventTracker','custom_event_name':'cta_click','page_name':pageName,'cta_name':ctaName,'cta_type':ctaType,'cta_position':ctaPosition};dataLayer.push(dLayerObject);console.log('Generic cta click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});$(once('slide-navigation',`.swiper-button-prev, 
                            .swiper-button-next,
                            .journey-arrow .next-button,
                            .journey-arrow .previous-button-slider
                        `)).click(function(){var pageName=getPageTitle();let ctaType='slider';var ctaPosition=getCtaPosition($(this));var ctaName='slide navigation';var swiper=true;if($(this).hasClass('previous-button-slider')||$(this).hasClass('next-button'))swiper=false;if($(this).hasClass('swiper-button-prev')||$(this).hasClass('next-button'))ctaName='slide left';else{if($(this).hasClass('swiper-button-next')||$(this).hasClass('previous-button-slider'))ctaName='slide right';}var title=getSlideBannerTitle($(this),swiper);if(title)ctaName=`${title}:${ctaName}`;var dLayerObject={'event':'eventTracker','custom_event_name':'cta_click','page_name':pageName,'cta_name':ctaName,'cta_type':ctaType,'cta_position':ctaPosition};dataLayer.push(dLayerObject);console.log('Generic cta click event triggered: ',dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});function getSlideBannerTitle(slide,swiper){var title='';var activeSlide=false;if(swiper){if($(slide).closest('.swiper').length>0)var activeSlide=$(slide).closest('.swiper').find('.swiper-slide-active');else{if($(slide).closest('div').parent().prev('.swiper').length>0)var activeSlide=$(slide).closest('div').parent().prev('.swiper').find('.swiper-slide-active');}if($(activeSlide).data('title'))title=$(activeSlide).data('title').trim().toLowerCase();else if($(activeSlide).find('h4').length>0){if($('.page-node-type-properties-in-dubai').length>0)title=`${drupalSettings.sobha_event?.projectName.trim().toLowerCase()}:`;if($(activeSlide).find('h4').data("translated-text"))title+=$(activeSlide).find('h4').data("translated-text").trim().toLowerCase();else title+=$(activeSlide).find('h4').text().trim().toLowerCase();}else if($('.recognition-slider-philanthropy').length>0&&$(activeSlide).find('h3').length>0)title=`${String($(activeSlide).find('h3').data("translated-text")).trim().toLowerCase()} - ${$(activeSlide).find('p').data("translated-text").trim().toLowerCase()}`;else if($(slide).closest('.events-recognition').length>0&&$(activeSlide).find('h5').length>0)title=`${$(activeSlide).find('h5').data("translated-text").trim().toLowerCase()}`;else if($(slide).closest('.recognition-sec').length>0&&$(activeSlide).find('h5').length>0)title=`${$(activeSlide).find('h5').data("translated-text").trim().toLowerCase()}`;else if($('.project-slider-div').length>0&&$(slide).closest('.river-side-row').find('.river-side-list-right').length>0)title=`${drupalSettings.sobha_event?.propertyName}:${$(slide).closest('.river-side-row').find('.river-side-list-right').find('h5').data("translated-text").trim().toLowerCase()}`;else if($(slide).closest('.listing-div').find('h5').length>0){if($(slide).closest('.listing-div').data('group-property'))title=`${$(slide).closest('.listing-div').data('group-property').trim().toLowerCase()}:`;if($(slide).closest('.listing-div').find('h5').data("translated-text"))title+=$(slide).closest('.listing-div').find('h5').data("translated-text").trim().toLowerCase();else{if($(slide).closest('.listing-div').find('h5 a').data("translated-text"))title+=$(slide).closest('.listing-div').find('h5 a').data("translated-text").trim().toLowerCase();}}else{if($('.page-node-type-properties-in-dubai').length>0)title=drupalSettings.sobha_event?.projectName;}}return title;}function getCtaPosition(ctaElement){var rect=ctaElement[0].getBoundingClientRect();var totalHeight=document.documentElement.scrollHeight;var elementTop=rect.top+window.scrollY;var elementPositionPercentage=(elementTop/totalHeight)*100;var position='center';if(elementPositionPercentage<30)position='top';else if(elementPositionPercentage>=30&&elementPositionPercentage<58)position='center';else{if(elementPositionPercentage>=58)position='bottom';}return position;}function getPageTitle(){var pageName='';if(drupalSettings.sobha_event?.pageName){pageName=drupalSettings.sobha_event.pageName;if(drupalSettings.sobha_event.propertyName)pageName=drupalSettings.sobha_event.propertyName;if(drupalSettings.sobha_event.projectName)pageName=drupalSettings.sobha_event.projectName;if(drupalSettings.sobha_event.mediaContentName)pageName=drupalSettings.sobha_event.mediaContentName;}else pageName=document.title;return pageName.toLowerCase();}$(once('wishlist-click',".wishlist-share-section .wishlist-main-wrapper, #wishlist-container .wishlist-remove")).click(function(){if($(this).hasClass('wish-active')||$(this).hasClass('wishlist-remove'))var eventName='remove_from_wishlist';else var eventName='add_to_wishlist';if(drupalSettings.sobha_event?.propertyName){var projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();var propertyName=drupalSettings.sobha_event.propertyName;var propType=drupalSettings.sobha_event.propertyType?.trim().toLowerCase()??'';var unitType=$('#project-detail-units').data('unit-type').toLowerCase().trim();}else{var parentDiv=$(this).closest('.listing-div');if($(parentDiv).find('h5 a').length>0)var projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else var projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();var propertyName=$(parentDiv).data('group-property')??projectName;var propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();var unitType=$(parentDiv).find('p.no-of-bedrooms').data('unit-type')?.trim().toLowerCase();}var dLayerObject={'event':'eventTracker','custom_event_name':eventName,'project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType,'event_weightage':3};dataLayer.push(dLayerObject);console.log(`Wishlist ${eventName}:`,dLayerObject);});$(once('wishlist-clear-all',".remove-show-wrapper a.clear-all-wishlist")).click(function(){var dLayerObject={'event':'eventTracker','custom_event_name':'clear_wishlist','event_weightage':1};dataLayer.push(dLayerObject);console.log(`Wishlist clear all items event`,dLayerObject);window.triggerWebengageEventFromDataLayer(dLayerObject);});const $vrModal=$('.modal#VRpopup');if($vrModal.length){let engagementTimer;let triggerButton=null;let activeUnitTypeInModal=null;$vrModal.on('shown.bs.modal',function(event){triggerButton=jQuery(event.relatedTarget);activeUnitTypeInModal=jQuery(event.target).find('select#walkthroughSelect').val();let dLayerObject={};if($(triggerButton).closest('.virtual-floor-plan-wrapper').length>0){let propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();let unitType=$(triggerButton).closest('.virtual-floor-plan-wrapper').find('.category-button.active').data("translated-text").trim().toLowerCase().replace('br','bedroom');let propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();let projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();let priceRange='';if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange'))priceRange=`from ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange').replace('<br>','').trim().toLowerCase()}`;if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange'))priceRange+=` to ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange').replace('<br>','').trim().toLowerCase()}`;dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough','project_name':projectName,'property_name':propertyName,'property_type':propType,'unit_type':unitType,'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}else{if($(triggerButton).closest('.listing-div').length>0){let parentDiv=$(triggerButton).closest('.listing-div');let propertyName=$(parentDiv).data('group-property');let unitType=$(parentDiv).find('p.no-of-bedrooms').data('unit-type')?.trim().toLowerCase();let propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();let projectName;if($(parentDiv).find('h5 a').length>0)projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();let priceRange='';if($(parentDiv).find('span.p-range').length>0){priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;}dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough','project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType,'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}}if(dLayerObject&&Object.entries(dLayerObject).length>0){dataLayer.push(dLayerObject);console.log('Walkthrough click event triggered: ',dLayerObject);let timeSpent=0;let timeLimit=15*1000;console.log('Walkthrough engagement timer started');engagementTimer=setInterval(function(){timeSpent+=1000;if(timeSpent>=timeLimit){clearInterval(engagementTimer);let engagementDLayerObject=JSON.parse(JSON.stringify(dLayerObject));engagementDLayerObject.custom_event_name='walkthrough_engagement_bucketed';dataLayer.push(engagementDLayerObject);console.log(`Walkthrough engagement: 15 seconds`,engagementDLayerObject);}},1000);}});$vrModal.on('hidden.bs.modal',function(event){clearInterval(engagementTimer);if(triggerButton&&activeUnitTypeInModal){let dLayerObject={};if($(triggerButton).closest('.virtual-floor-plan-wrapper').length>0){let propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();let unitType=activeUnitTypeInModal?.trim()?.toLowerCase();let propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();let projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();let priceRange='';if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange'))priceRange=`from ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange').replace('<br>','').trim().toLowerCase()}`;if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange'))priceRange+=` to ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange').replace('<br>','').trim().toLowerCase()}`;dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough_exit','project_name':projectName,'property_name':propertyName,'property_type':propType,'unit_type':unitType,'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}else{if($(triggerButton).closest('.listing-div').length>0){let parentDiv=$(triggerButton).closest('.listing-div');let propertyName=$(parentDiv).data('group-property');let unitType=activeUnitTypeInModal?.trim()?.toLowerCase();let propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();let projectName;if($(parentDiv).find('h5 a').length>0)projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();let priceRange='';if($(parentDiv).find('span.p-range').length>0){priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;}dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough_exit','project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType?.replace('br','bedroom'),'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}}if(dLayerObject&&Object.entries(dLayerObject).length>0){dataLayer.push(dLayerObject);console.log('Walkthrough exit event triggered: ',dLayerObject);}triggerButton=null;}});const $walkthroughSelect=$('#VRpopup #walkthroughSelect');if($walkthroughSelect.length)jQuery(once('walkthrough-typology-event',$walkthroughSelect)).change(function(){activeUnitTypeInModal=$(this).val();if(triggerButton){let dLayerObject={};if($(triggerButton).closest('.virtual-floor-plan-wrapper').length>0){let propertyName=drupalSettings.sobha_event.propertyName.trim().toLowerCase();let unitType=activeUnitTypeInModal?.trim()?.toLowerCase();let propType=drupalSettings.sobha_event.propertyType.trim().toLowerCase();let projectName=drupalSettings.sobha_event.projectName.trim().toLowerCase();let priceRange='';if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange'))priceRange=`from ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('sprange').replace('<br>','').trim().toLowerCase()}`;if($(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange'))priceRange+=` to ${$(triggerButton).closest('.virtual-floor-plan-wrapper').data('hprange').replace('<br>','').trim().toLowerCase()}`;dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough_change_property','project_name':projectName,'property_name':propertyName,'property_type':propType,'unit_type':unitType,'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}else{if($(triggerButton).closest('.listing-div').length>0){let parentDiv=$(triggerButton).closest('.listing-div');let propertyName=$(parentDiv).data('group-property');let unitType=activeUnitTypeInModal?.trim()?.toLowerCase();let propType=$(parentDiv).find('p.no-of-bedrooms').data('prop-type')?.trim().toLowerCase();let projectName;if($(parentDiv).find('h5 a').length>0)projectName=$(parentDiv).find('h5 a').data("translated-text").trim().toLowerCase();else projectName=$(parentDiv).find('h5').data("translated-text").trim().toLowerCase();let priceRange='';if($(parentDiv).find('span.p-range').length>0){priceRange=`from ${$(parentDiv).find('span.p-range').eq(0).data("translated-text").replace('<br>','').trim().toLowerCase()}`;if($(parentDiv).find('span.p-range').eq(1).length>0)priceRange+=` to ${$(parentDiv).find('span.p-range').eq(1).data("translated-text").replace('<br>','').trim().toLowerCase()}`;}dLayerObject={'event':'eventTracker','custom_event_name':'walkthrough_change_property','project_name':projectName,'property_name':propertyName?propertyName.trim().toLowerCase():projectName,'property_type':propType,'unit_type':unitType?.replace('br','bedroom'),'event_weightage':3};if(priceRange!='')dLayerObject.property_price_range=priceRange;}}if(dLayerObject&&Object.entries(dLayerObject).length>0){dataLayer.push(dLayerObject);console.log('Walkthrough change typology event triggered: ',dLayerObject);}}});}jQuery(once('vr-link','.VR-btn a.vr, a.enq-btn-vr-mobile, .VR-btn button.vr, button.enq-btn-vr-mobile')).click(function(){let dLayerObject={'event':'eventTracker','custom_event_name':'enquiry_clicked','page_name':drupalSettings.sobha_event.pageName,'cta_name':'walkthrough','event_weightage':3};dataLayer.push(dLayerObject);console.log('Walkthrough cta click event triggered: ',dLayerObject);});}});}};})(jQuery,Drupal);;
